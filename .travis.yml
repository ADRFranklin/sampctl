sudo: required
services:
  - docker
before_install:
  - if [ `uname -m` = x86_64 ]; then sudo apt-get install -qq --force-yes gcc-multilib > /dev/null; fi
addons:
  apt:
    packages:
      - docker-ce
language: go
jobs:
  include:
    - stage: dependencies
      script: make deps
    - stage: test
      script: make test
after_success:
  - docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD"
  - apt-get install ruby ruby-dev rubygems build-essential
  - gem install --no-ri --no-rdoc fpm
  - test -n "$TRAVIS_TAG" && curl -sL https://git.io/goreleaser | bash
go:
  - 1.x
